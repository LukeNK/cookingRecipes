<!DOCTYPE html>
<head>
    <script src="./data/id.js"></script>
    <script src="./data/recipes.js"></script>
    <style>
        * {
            /* CSS HEX */
            --color-bg: #343434ff;
            --color-fg: #f7fff7ff;
            --color-theme: #2f3061ff;
            --color-highlight: #ffe66dff;
            --color-light: #6ca6c1ff;
            --font-size: 16px;
            font-family: helvetica, arial;
        }

        /* Elements */

        article table {
            width: 100%;
            border-collapse: collapse;
        }
        article tr { border: none; }
        article th, article td {
            border-right: solid 1px var(--color-highlight); 
            border-left: solid 1px var(--color-highlight);
            text-align: center;
        }

        button {
            border: 0px none transparent;
            background-color: var(--color-theme);
            color: var(--color-fg);
            font-size: var(--font-size);
        }

        details {
            border-left: 1rem solid var(--color-light);
            border-bottom: 1px solid var(--color-light);
            padding-left: 1rem;
        }

        form {
            border: 1px solid var(--color-fg);
            border-radius: 0.5rem;
            margin-bottom: 1rem;
            padding: 1rem;
        }

        input {
            font-size: var(--font-size);
            outline: none;
            border: 1px solid var(--color-highlight);
            background-color: var(--color-bg);
            color: var(--color-fg);
        }

        p {
            font-size: var(--font-size);
        }

        span {
            font-size: var(--font-size);
        }

        summary {
            cursor: pointer;
        }

        /* Layouts */

        body {
            padding: 0;
            margin: 0;
            font-size: var(--font-size);
            font-family: var(--font-family);
            background-color: var(--color-bg);
            color: var(--color-fg);
        }

        nav {
            display: flex;
        }
        nav > button {
            flex: 1;
            margin: 0;
            height: 2rem;
            font-size: var(--font-size);
        }
        nav > button:hover {
            background-color: var(--color-light);
            color: var(--color-theme);
        }

        main {
            padding: 1rem;
        }
    </style>
</head>

<body>
    <header>
        <nav>
            <button onclick="">SEARCH</button>
            <button onclick="">BROWSE</button>
        </nav>
    </header>
    <main>
        <div id="search">
            <label>
                Search by name:
                <input type="text" oninput="searchNameInput(this.value)">
            </label>
            <p>The only ingredient we assume you have is salt, peper, and ✨determination✨.</p>
            <ul id="ingredientsSearch">
                <li><button onclick="ingredientsSearchAdd()">Add ingredient</button></li>
            </ul>
            <button>Search by ingredients</button>
        </div>
        <hr>
        <div id="browse"></div>
    </main>
</body>

<script>
// UI functions
function searchNameInput(query) {
    displayRecipes(nameSearch(recipes, query))
}


function ingredientsSearchAdd() {
    document.getElementById('ingredientsSearch').innerHTML += `
    <li>
        <input oninput="ingredientsSearchInput(this)"><span></span>
    </li>`
}

function ingredientsSearchInput(that) {
    let result = nameSearch(ingredients, that.value, true);
    let span = that.nextSibling;
    if (result.length != 0) span.innerHTML = 'Item found';
    else span.innerHTML = 'Item not found'
}

function displayRecipes(recipes) {
    let html = ''
    recipes.forEach(recipe => {
        html += `
        <article>
            <details id="recipe-${recipe.id}">
                <summary>${recipe.name}</summary>
                <table>
                    <tr>
                        <th>Prep time</th>
                        <th>Cook time</th>
                        <th>Servings</th>
                    </tr>
                    <tr>
                        <td>${recipe.prepTime} minutes</td>
                        <td>${recipe.cookTime} minutes</td>
                        <td>${recipe.servings}</td>
                    </tr>
                </table>
            </details>
        </article>`;
        displayRecipe(recipe.id);
    });
    document.getElementById('browse').innerHTML = html;
}

async function displayRecipe(id) {
    let recipe = recipes[id];
    const response = await fetch(`./recipes/${id}.html`);
    const html = await response.text();
    document.getElementById(`recipe-${id}`).innerHTML += html;
}

// back-end functions
function nameSearch(source, query, match) {
    // match: exact match or not
    let results = [];
    query = query.toLowerCase()
    source.forEach((elm, id) => {
        if (
            elm.name.toLowerCase().search(query) != -1
        ) {
            if (match) if (elm.name.toLowerCase() != query) return;
            elm.id = id;
            results.push(elm);
        }
    });
    return results;
}
</script>